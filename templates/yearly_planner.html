<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yearly Planner - USTAAD DOST</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- jsPDF Library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- PostHog Analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_GCkBP3jnuPlIpfsiu9ONXGVj8j76QKa5jewcYWeOCw7',{api_host:'https://us.i.posthog.com'})
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">üìÖ Yearly Planner</h1>
            <div class="nav-menu">
                <a href="{{ url_for('index') }}" class="nav-link">üè† Dashboard</a>
                <a href="{{ url_for('chatbot') }}" class="nav-link">ü§ñ U-Dost Chat</a>
                <span class="nav-welcome">Welcome, {{ session.user_name }}!</span>
                <a href="#" onclick="logout()" class="nav-link logout-link">üö™ Logout</a>
            </div>
        </div>
    </nav>

    <!-- Zoom Controls -->
    <div class="zoom-controls" style="position: fixed; top: 10px; right: 10px; z-index: 1000;">
        <button onclick="zoomIn()" class="zoom-btn">üîç+</button>
        <button onclick="zoomOut()" class="zoom-btn">üîç-</button>
        <button onclick="resetZoom()" class="zoom-btn">‚Üª</button>
        <span id="zoomLevel">100%</span>
    </div>

    <main class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="planner-container">
            <div class="welcome-section">
                <h1>üìÖ Enhanced Yearly Planner</h1>
                <p class="welcome-subtitle">Create weekly template, copy to entire year, and manage monthly schedules</p>
            </div>
            
            <!-- Enhanced Frontend-Only Yearly Planner System -->
            <div id="yearlyPlannerSection">
                <div id="weeklyPlanner" class="planner-step">
                    <!-- Weekly planner will load here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // Common session management function
        function getCurrentUser() {
            const savedUser = localStorage.getItem('ustaadDostUser');
            return savedUser ? JSON.parse(savedUser) : null;
        }
        
        function logout() {
            console.log("Logging out user..."); // Debug log
            localStorage.removeItem('ustaadDostUser');
            sessionStorage.clear();
            console.log("Local session data cleared"); // Debug log
            window.location.href = '/logout';
        }
        
        // ===========================================
        // ZOOM FUNCTIONALITY
        // ===========================================
        
        let currentZoom = 100;

        function zoomIn() {
            if (currentZoom < 200) {
                currentZoom += 10;
                applyZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > 70) {
                currentZoom -= 10;
                applyZoom();
            }
        }

        function resetZoom() {
            currentZoom = 100;
            applyZoom();
        }

        function applyZoom() {
            document.body.style.zoom = currentZoom + '%';
            document.getElementById('zoomLevel').textContent = currentZoom + '%';
            localStorage.setItem('appZoomLevel', currentZoom);
        }

        // Load saved zoom on page load
        window.addEventListener('load', function() {
            const savedZoom = localStorage.getItem('appZoomLevel');
            if (savedZoom) {
                currentZoom = parseInt(savedZoom);
                applyZoom();
            }
        });
        
        // ===========================================
        // ENHANCED YEARLY PLANNER SYSTEM
        // ===========================================
        
        // Initialize the yearly planner with memory check on page load
        document.addEventListener('DOMContentLoaded', function() {
            openYearlyPlanner();
        });
        
        // MEMORY CHECK LOGIC - Show calendar if plan exists, creation form if not
        function openYearlyPlanner() {
            const savedPlan = localStorage.getItem('yearlyPlan');
            
            if (savedPlan && savedPlan !== '{}') {
                // Plan exists - show calendar
                showCalendarView();
            } else {
                // No plan - show creation
                showWeeklyCreation();
            }
        }
        
        // Show calendar view with months
        function showCalendarView() {
            showMonthlyView();
        }
        
        // Show weekly creation form
        function showWeeklyCreation() {
            loadWeeklyPlanner();
        }
        
        // ENHANCED WEEKLY PLANNER WITH GRADE SELECTION PER PERIOD
        function loadWeeklyPlanner() {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const subjects = ['English', 'Urdu', 'Islamiyat', 'General Knowledge', 'Science', 'Social Studies', 'Math'];
            const grades = ['Grade 1', 'Grade 2', 'Grade 3', 'Grade 4', 'Grade 5'];
            
            let plannerHTML = `<h2>Create Weekly Template</h2>`;
            
            days.forEach(day => {
                plannerHTML += `<div class="day-column">
                    <h3>${day}</h3>`;
                
                for (let period = 1; period <= 8; period++) {
                    plannerHTML += `
                        <div class="period-row">
                            <label>Period ${period}:</label>
                            <select id="${day}_period${period}_subject">
                                <option value="">Select Subject</option>
                                ${subjects.map(subject => `<option value="${subject}">${subject}</option>`).join('')}
                            </select>
                            <select id="${day}_period${period}_grade">
                                <option value="">Select Grade</option>
                                ${grades.map(grade => `<option value="${grade}">${grade}</option>`).join('')}
                            </select>
                            <input type="time" id="${day}_period${period}_start" value="08:00">
                            <input type="time" id="${day}_period${period}_end" value="08:40">
                        </div>`;
                }
                
                plannerHTML += `
                    <div class="break-row">
                        <label>Break:</label>
                        <input type="time" id="${day}_break_start" value="10:00">
                        <input type="time" id="${day}_break_end" value="10:20">
                    </div>
                </div>`;
            });
            
            plannerHTML += `<button onclick="saveAndCopyToYear()" class="btn btn-success save-btn">Save & Copy to Entire Year</button>`;
            
            document.getElementById('weeklyPlanner').innerHTML = plannerHTML;
        }
        
        // ENHANCED SAVE AND COPY TO ENTIRE YEAR WITH VALIDATION
        function saveAndCopyToYear() {
            const weeklyTemplate = {};
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            
            // Save weekly template with validation
            let hasContent = false;
            days.forEach(day => {
                weeklyTemplate[day] = {};
                for (let period = 1; period <= 8; period++) {
                    const subject = document.getElementById(`${day}_period${period}_subject`)?.value || '';
                    const grade = document.getElementById(`${day}_period${period}_grade`)?.value || '';
                    
                    if (subject) hasContent = true; // Check if any content exists
                    
                    weeklyTemplate[day][`period${period}`] = {
                        subject: subject,
                        grade: grade,
                        startTime: document.getElementById(`${day}_period${period}_start`)?.value || '08:00',
                        endTime: document.getElementById(`${day}_period${period}_end`)?.value || '08:40'
                    };
                }
                weeklyTemplate[day].break = {
                    startTime: document.getElementById(`${day}_break_start`)?.value || '10:00',
                    endTime: document.getElementById(`${day}_break_end`)?.value || '10:20'
                };
            });
            
            if (!hasContent) {
                alert('Please add at least one subject to save!');
                return;
            }
            
            // ACTUALLY SAVE THE DATA
            localStorage.setItem('weeklyTemplate', JSON.stringify(weeklyTemplate));
            console.log('Weekly template saved:', weeklyTemplate); // Debug log
            
            // Copy to entire year
            const yearlyPlan = {};
            for (let month = 1; month <= 12; month++) {
                for (let date = 1; date <= 31; date++) {
                    const dateKey = `${month}-${date}`;
                    const dayOfWeek = new Date(2024, month-1, date).getDay();
                    
                    if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                        const dayName = days[dayOfWeek - 1];
                        yearlyPlan[dateKey] = JSON.parse(JSON.stringify(weeklyTemplate[dayName]));
                    }
                }
            }
            
            localStorage.setItem('yearlyPlan', JSON.stringify(yearlyPlan));
            console.log('Yearly plan saved!'); // Debug log
            
            alert('‚úÖ Weekly plan copied to entire year!');
            showMonthlyView();
        }
        
        // SHOW MONTHLY CALENDAR VIEW
        function showMonthlyView() {
            document.getElementById('weeklyPlanner').style.display = 'none';
            
            let calendarHTML = `
                <h2>Your Yearly Plan</h2>
                <div class="calendar-navigation">
                    <button onclick="showMonth(1)" class="month-btn">Jan</button>
                    <button onclick="showMonth(2)" class="month-btn">Feb</button>
                    <button onclick="showMonth(3)" class="month-btn">Mar</button>
                    <button onclick="showMonth(4)" class="month-btn">Apr</button>
                    <button onclick="showMonth(5)" class="month-btn">May</button>
                    <button onclick="showMonth(6)" class="month-btn">Jun</button>
                    <button onclick="showMonth(7)" class="month-btn">Jul</button>
                    <button onclick="showMonth(8)" class="month-btn">Aug</button>
                    <button onclick="showMonth(9)" class="month-btn">Sep</button>
                    <button onclick="showMonth(10)" class="month-btn">Oct</button>
                    <button onclick="showMonth(11)" class="month-btn">Nov</button>
                    <button onclick="showMonth(12)" class="month-btn">Dec</button>
                </div>
                <div id="monthDisplay"></div>
                <div class="yearly-actions">
                    <button onclick="loadWeeklyPlanner(); document.getElementById('weeklyPlanner').style.display='block'; document.getElementById('calendarView').style.display='none';" class="btn btn-secondary">Back to Weekly Template</button>
                </div>
            `;
            
            document.getElementById('yearlyPlannerSection').innerHTML += `<div id="calendarView">${calendarHTML}</div>`;
            
            // Show current month by default
            showMonth(new Date().getMonth() + 1);
        }
        
        // ENHANCED COLORFUL CALENDAR
        function showMonth(month) {
            const yearlyPlan = JSON.parse(localStorage.getItem('yearlyPlan') || '{}');
            const monthNames = ['', 'January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const today = new Date();
            const currentMonth = today.getMonth() + 1;
            const currentDate = today.getDate();
            
            let monthHTML = `
                <div class="calendar-header">
                    <h3>üìÖ ${monthNames[month]} 2024</h3>
                    <div class="calendar-stats">
                        <span class="stat-pill">üìö School Days: ${countSchoolDays(month)}</span>
                        <span class="stat-pill">üéØ Classes Planned: ${countPlannedClasses(month)}</span>
                    </div>
                </div>
                
                <div class="weekdays-header">
                    <div class="weekday">Mon</div>
                    <div class="weekday">Tue</div>
                    <div class="weekday">Wed</div>
                    <div class="weekday">Thu</div>
                    <div class="weekday">Fri</div>
                </div>
                
                <div class="calendar-grid">`;
            
            for (let date = 1; date <= 31; date++) {
                const dateKey = `${month}-${date}`;
                const dayPlan = yearlyPlan[dateKey];
                const isToday = (month === currentMonth && date === currentDate);
                const dayOfWeek = new Date(2024, month-1, date).getDay();
                
                if (dayPlan && dayOfWeek >= 1 && dayOfWeek <= 5) {
                    const subjects = getSubjectsForDay(dayPlan);
                    monthHTML += `
                        <div class="calendar-day ${isToday ? 'today' : ''}" onclick="editDay('${dateKey}')">
                            <div class="date-number">${date}</div>
                            <div class="day-preview">
                                <div class="subject-pills">
                                    ${subjects.map(subject => `<span class="subject-pill ${subject.toLowerCase()}">${subject}</span>`).join('')}
                                </div>
                                <div class="classes-count">${subjects.length} classes</div>
                            </div>
                            <div class="edit-hint">‚úèÔ∏è Click to edit</div>
                        </div>
                    `;
                } else {
                    monthHTML += `<div class="calendar-day empty ${isToday ? 'today-empty' : ''}">${date}</div>`;
                }
            }
            
            monthHTML += '</div>';
            document.getElementById('monthDisplay').innerHTML = monthHTML;
            
            // Add today's sidebar
            addTodaysSidebar();
        }

        function getSubjectsForDay(dayPlan) {
            const subjects = [];
            for (let period = 1; period <= 8; period++) {
                const subject = dayPlan[`period${period}`]?.subject;
                if (subject && !subjects.includes(subject)) {
                    subjects.push(subject);
                }
            }
            return subjects;
        }
        
        function countSchoolDays(month) {
            let count = 0;
            for (let date = 1; date <= 31; date++) {
                const dayOfWeek = new Date(2024, month-1, date).getDay();
                if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                    count++;
                }
            }
            return count;
        }
        
        function countPlannedClasses(month) {
            const yearlyPlan = JSON.parse(localStorage.getItem('yearlyPlan') || '{}');
            let count = 0;
            for (let date = 1; date <= 31; date++) {
                const dateKey = `${month}-${date}`;
                const dayPlan = yearlyPlan[dateKey];
                if (dayPlan) {
                    for (let period = 1; period <= 8; period++) {
                        if (dayPlan[`period${period}`]?.subject) {
                            count++;
                        }
                    }
                }
            }
            return count;
        }
        
        // EDIT INDIVIDUAL DAY
        function editDay(dateKey) {
            const yearlyPlan = JSON.parse(localStorage.getItem('yearlyPlan') || '{}');
            const dayPlan = yearlyPlan[dateKey];
            const subjects = ['English', 'Urdu', 'Islamiyat', 'General Knowledge', 'Science', 'Social Studies', 'Math'];
            const grades = ['Grade 1', 'Grade 2', 'Grade 3', 'Grade 4', 'Grade 5'];
            
            let editHTML = `<h3>Edit Day: ${dateKey}</h3>`;
            
            for (let period = 1; period <= 8; period++) {
                const periodData = dayPlan[`period${period}`] || {};
                editHTML += `
                    <div class="edit-period">
                        <label>Period ${period}:</label>
                        <select id="edit_period${period}_subject">
                            <option value="">Select Subject</option>
                            ${subjects.map(subject => 
                                `<option value="${subject}" ${periodData.subject === subject ? 'selected' : ''}>${subject}</option>`
                            ).join('')}
                        </select>
                        <select id="edit_period${period}_grade">
                            <option value="">Select Grade</option>
                            ${grades.map(grade => 
                                `<option value="${grade}" ${periodData.grade === grade ? 'selected' : ''}>${grade}</option>`
                            ).join('')}
                        </select>
                        <input type="time" id="edit_period${period}_start" value="${periodData.startTime || '08:00'}">
                        <input type="time" id="edit_period${period}_end" value="${periodData.endTime || '08:40'}">
                    </div>
                `;
            }
            
            editHTML += `
                <div class="edit-break">
                    <label>Break:</label>
                    <input type="time" id="edit_break_start" value="${dayPlan.break?.startTime || '10:00'}">
                    <input type="time" id="edit_break_end" value="${dayPlan.break?.endTime || '10:20'}">
                </div>
                <div class="edit-actions">
                    <button onclick="saveDayEdit('${dateKey}')" class="btn btn-success">Save Changes</button>
                    <button onclick="closeEdit()" class="btn btn-secondary">Cancel</button>
                </div>
            `;
            
            document.getElementById('monthDisplay').innerHTML = editHTML;
        }
        
        // SAVE DAY EDIT
        function saveDayEdit(dateKey) {
            const yearlyPlan = JSON.parse(localStorage.getItem('yearlyPlan') || '{}');
            
            yearlyPlan[dateKey] = {};
            for (let period = 1; period <= 8; period++) {
                yearlyPlan[dateKey][`period${period}`] = {
                    subject: document.getElementById(`edit_period${period}_subject`).value,
                    grade: document.getElementById(`edit_period${period}_grade`).value,
                    startTime: document.getElementById(`edit_period${period}_start`).value,
                    endTime: document.getElementById(`edit_period${period}_end`).value
                };
            }
            yearlyPlan[dateKey].break = {
                startTime: document.getElementById('edit_break_start').value,
                endTime: document.getElementById('edit_break_end').value
            };
            
            localStorage.setItem('yearlyPlan', JSON.stringify(yearlyPlan));
            alert('Day updated successfully!');
            
            // Go back to month view
            const month = dateKey.split('-')[0];
            showMonth(parseInt(month));
        }
        
        // CLOSE EDIT
        function closeEdit() {
            const month = new Date().getMonth() + 1;
            showMonth(month);
        }
        
        // TODAY'S SCHEDULE SIDEBAR
        function addTodaysSidebar() {
            // Remove existing sidebar if present
            const existingSidebar = document.querySelector('.todays-schedule');
            if (existingSidebar) {
                existingSidebar.remove();
            }
            
            const today = new Date();
            const month = today.getMonth() + 1;
            const date = today.getDate();
            const dateKey = `${month}-${date}`;
            const yearlyPlan = JSON.parse(localStorage.getItem('yearlyPlan') || '{}');
            const todayPlan = yearlyPlan[dateKey];
            
            const sidebarHTML = `
                <div class="todays-schedule" style="position: fixed; left: 20px; top: 100px; width: 250px; background: #f8f9fa; border-radius: 10px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 999;">
                    <h4>üìã Today's Schedule</h4>
                    <div class="date-display">${today.toDateString()}</div>
                    
                    ${todayPlan ? `
                        <div class="today-periods">
                            ${generateTodayPeriods(todayPlan)}
                        </div>
                        <button onclick="editDay('${dateKey}')" class="edit-today-btn">‚úèÔ∏è Edit Today</button>
                    ` : `
                        <div class="no-schedule">
                            <p>üìù No classes scheduled for today</p>
                            <button onclick="editDay('${dateKey}')" class="add-today-btn">‚ûï Add Schedule</button>
                        </div>
                    `}
                </div>
            `;
            
            document.body.innerHTML += sidebarHTML;
        }

        function generateTodayPeriods(todayPlan) {
            let periodsHTML = '';
            for (let period = 1; period <= 8; period++) {
                const periodData = todayPlan[`period${period}`];
                if (periodData && periodData.subject) {
                    periodsHTML += `
                        <div class="period-item">
                            <span class="period-time">${periodData.startTime}-${periodData.endTime}</span>
                            <span class="period-subject ${periodData.subject.toLowerCase().replace(/\s+/g, '')}">${periodData.subject}</span>
                            <span class="period-grade">${periodData.grade}</span>
                        </div>
                    `;
                }
            }
            
            if (todayPlan.break) {
                periodsHTML += `
                    <div class="break-item">
                        <span class="break-time">‚òï ${todayPlan.break.startTime}-${todayPlan.break.endTime}</span>
                        <span class="break-label">Break Time</span>
                    </div>
                `;
            }
            
            return periodsHTML;
        }
    </script>
    
    <style>
        /* Frontend-Only Yearly Planner Styles */
        .planner-step {
            background: var(--light-gray);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .planner-step h2 {
            color: var(--sage-green);
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .grade-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .grade-btn {
            background: white;
            border: 3px solid var(--soft-blue);
            color: var(--soft-blue);
            padding: 1.5rem 2rem;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .grade-btn:hover {
            background: var(--soft-blue);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(108, 155, 209, 0.3);
        }
        
        /* Enhanced Weekly Planner Styles */
        #weeklyPlanner {
            background: white;
        }
        
        #weeklyPlanner h2 {
            color: var(--sage-green);
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .day-column {
            background: var(--light-gray);
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem;
            display: inline-block;
            vertical-align: top;
            width: 280px;
        }
        
        .day-column h3 {
            color: var(--soft-blue);
            text-align: center;
            margin-bottom: 1rem;
            background: white;
            padding: 0.5rem;
            border-radius: 6px;
        }
        
        .period-row {
            background: white;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border: 1px solid var(--border-gray);
        }
        
        .period-row label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .period-row select {
            width: 48%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            margin-right: 2%;
            font-size: 0.9rem;
        }
        
        .period-row input[type="time"] {
            width: 23%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-right: 2%;
        }
        
        .break-row {
            background: var(--peach);
            padding: 0.75rem;
            margin: 1rem 0;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
        }
        
        .break-row label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .break-row input[type="time"] {
            width: 48%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .break-row input[type="time"]:first-of-type {
            margin-right: 4%;
        }
        
        .save-btn {
            display: block;
            margin: 2rem auto;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        /* Monthly Calendar View Styles */
        #calendarView {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
        }
        
        #calendarView h2 {
            color: var(--sage-green);
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .calendar-navigation {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        
        .month-btn {
            background: white;
            border: 2px solid var(--soft-blue);
            color: var(--soft-blue);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .month-btn:hover {
            background: var(--soft-blue);
            color: white;
            transform: translateY(-2px);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .calendar-day {
            background: var(--light-gray);
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            padding: 1rem;
            min-height: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-day:hover {
            background: var(--mint-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .calendar-day.empty {
            background: #f8f8f8;
            color: #ccc;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            background: #f8f8f8;
            transform: none;
            box-shadow: none;
        }
        
        .calendar-day strong {
            display: block;
            font-size: 1.2rem;
            color: var(--sage-green);
            margin-bottom: 0.5rem;
        }
        
        .day-preview {
            font-size: 0.8rem;
            color: #666;
        }
        
        .day-preview small {
            display: block;
            margin-bottom: 0.25rem;
        }
        
        /* Individual Day Editing Styles */
        .edit-period {
            background: var(--light-gray);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border: 1px solid var(--border-gray);
        }
        
        .edit-period label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .edit-period select {
            width: 48%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            margin-right: 2%;
            font-size: 0.9rem;
        }
        
        .edit-period input[type="time"] {
            width: 23%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-right: 2%;
        }
        
        .edit-break {
            background: var(--peach);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
        }
        
        .edit-break label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .edit-break input[type="time"] {
            width: 48%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .edit-break input[type="time"]:first-of-type {
            margin-right: 4%;
        }
        
        .edit-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }
        
        .yearly-actions {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
        }
        
        /* ENHANCED COLORFUL CALENDAR STYLES */
        .calendar-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .calendar-header h3 {
            color: var(--sage-green);
            margin-bottom: 1rem;
        }
        
        .calendar-stats {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .stat-pill {
            background: var(--mint-green);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }
        
        .weekdays-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
            background: var(--soft-blue);
            padding: 1rem;
            border-radius: 8px;
        }
        
        .weekday {
            text-align: center;
            font-weight: 600;
            color: white;
            font-size: 1.1rem;
        }
        
        .calendar-day.today {
            border: 3px solid #007bff !important;
            box-shadow: 0 0 15px rgba(0,123,255,0.3) !important;
            animation: pulse 2s infinite;
        }
        
        .calendar-day.today-empty {
            border: 2px solid #007bff !important;
            background: #e3f2fd !important;
        }
        
        .date-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--sage-green);
            margin-bottom: 0.5rem;
        }
        
        .subject-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-bottom: 0.5rem;
        }
        
        .subject-pill {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            color: white;
            margin: 1px;
            font-weight: 600;
        }
        
        .english { background: #28a745; }
        .urdu { background: #6f42c1; }
        .islamiyat { background: #20c997; }
        .generalknowledge { background: #ffc107; color: #333; }
        .science { background: #fd7e14; }
        .socialstudies { background: #e83e8c; }
        .math { background: #17a2b8; }
        
        .classes-count {
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }
        
        .edit-hint {
            font-size: 0.7rem;
            color: #999;
            margin-top: 0.5rem;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* ZOOM CONTROLS STYLING */
        .zoom-controls {
            background: white;
            padding: 8px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .zoom-btn {
            margin: 2px;
            padding: 8px 12px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background: var(--soft-blue);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .zoom-btn:hover {
            background: var(--sage-green);
            transform: translateY(-2px);
        }
        
        #zoomLevel {
            font-weight: 600;
            color: var(--sage-green);
            min-width: 40px;
            text-align: center;
        }
        
        /* TODAY'S SCHEDULE SIDEBAR STYLING */
        .todays-schedule h4 {
            color: var(--sage-green);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .date-display {
            background: var(--mint-green);
            padding: 0.5rem;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .period-item {
            background: white;
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border-left: 4px solid var(--soft-blue);
        }
        
        .period-time {
            display: block;
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }
        
        .period-subject {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: white;
            margin: 0.25rem 0;
            font-weight: 600;
        }
        
        .period-grade {
            display: block;
            font-size: 0.8rem;
            color: #333;
            font-weight: 600;
        }
        
        .break-item {
            background: var(--peach);
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
        }
        
        .break-time {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }
        
        .break-label {
            font-size: 0.8rem;
            color: #666;
        }
        
        .edit-today-btn, .add-today-btn {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 6px;
            background: var(--sage-green);
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }
        
        .edit-today-btn:hover, .add-today-btn:hover {
            background: var(--soft-blue);
            transform: translateY(-2px);
        }
        
        .no-schedule {
            text-align: center;
            padding: 1rem;
        }
        
        .no-schedule p {
            color: #666;
            margin-bottom: 1rem;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .day-column {
                width: 100%;
                margin: 1rem 0;
            }
            
            .grade-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .grade-btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
    
    <!-- Include existing CSS variables and common styles -->
        
        function autoFillSubjects() {
            if (confirm('Auto-fill subjects evenly across all periods?')) {
</body>
</html>
