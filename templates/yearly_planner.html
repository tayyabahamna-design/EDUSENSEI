<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yearly Planner - USTAAD DOST</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- jsPDF Library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- PostHog Analytics - Disabled to prevent JS errors -->
    <script>
        // Simple PostHog stub to prevent errors
        window.posthog = {
            capture: function() { console.log('PostHog tracking:', arguments); },
            identify: function() { console.log('PostHog identify:', arguments); }
        };
        console.log('PostHog stub initialized');
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">üìÖ Yearly Planner</h1>
            <div class="nav-menu">
                <a href="{{ url_for('index') }}" class="nav-link">üè† Dashboard</a>
                <a href="{{ url_for('grading_buddy') }}" class="nav-link">üìä Grading Buddy</a>
                <a href="{{ url_for('chatbot') }}" class="nav-link">ü§ñ U-Dost Chat</a>
                <span class="nav-welcome">Welcome, {{ session.user_name }}!</span>
                <a href="#" onclick="logout()" class="nav-link logout-link">üö™ Logout</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="planner-container">
            <div class="welcome-section">
                <h1>üìÖ Yearly Planner</h1>
                <p class="welcome-subtitle">Create your teaching schedule in 2 simple steps</p>
            </div>
            
            <!-- Frontend-Only Yearly Planner System -->
            <div id="yearlyPlannerSection">
                <div id="gradeSelection" class="planner-step">
                    <h2>Select Your Grade</h2>
                    <div class="grade-buttons">
                        <button onclick="selectGrade(1)" class="grade-btn">Grade 1</button>
                        <button onclick="selectGrade(2)" class="grade-btn">Grade 2</button>
                        <button onclick="selectGrade(3)" class="grade-btn">Grade 3</button>
                        <button onclick="selectGrade(4)" class="grade-btn">Grade 4</button>
                        <button onclick="selectGrade(5)" class="grade-btn">Grade 5</button>
                    </div>
                </div>
                
                <div id="weeklyPlanner" class="planner-step" style="display:none;">
                    <!-- Weekly planner will load here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // Common session management function
        function getCurrentUser() {
            const savedUser = localStorage.getItem('ustaadDostUser');
            return savedUser ? JSON.parse(savedUser) : null;
        }
        
        function logout() {
            console.log("Logging out user..."); // Debug log
            localStorage.removeItem('ustaadDostUser');
            sessionStorage.clear();
            console.log("Local session data cleared"); // Debug log
            window.location.href = '/logout';
        }
        
        // ===========================================
        // FRONTEND-ONLY YEARLY PLANNER SYSTEM
        // ===========================================
        
        // GRADE SELECTION FUNCTION
        function selectGrade(grade) {
            // Store selected grade
            localStorage.setItem('selectedGrade', grade);
            
            // Hide grade selection
            document.getElementById('gradeSelection').style.display = 'none';
            
            // Show weekly planner
            document.getElementById('weeklyPlanner').style.display = 'block';
            
            // Load weekly planner interface
            loadWeeklyPlanner(grade);
        }
        
        // WEEKLY PLANNER INTERFACE
        function loadWeeklyPlanner(grade) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const subjects = ['English', 'Urdu', 'Islamiyat', 'General Knowledge', 'Science', 'Social Studies', 'Math'];
            
            let plannerHTML = `<h2>Weekly Planner - Grade ${grade}</h2>`;
            
            days.forEach(day => {
                plannerHTML += `<div class="day-column">
                    <h3>${day}</h3>`;
                
                for (let period = 1; period <= 8; period++) {
                    plannerHTML += `
                        <div class="period-row">
                            <label>Period ${period}:</label>
                            <select id="${day}_period${period}">
                                <option value="">Select Subject</option>
                                ${subjects.map(subject => `<option value="${subject}">${subject}</option>`).join('')}
                            </select>
                            <input type="time" id="${day}_period${period}_start" value="08:00">
                            <input type="time" id="${day}_period${period}_end" value="08:40">
                        </div>`;
                }
                
                plannerHTML += `
                    <div class="break-row">
                        <label>Break:</label>
                        <input type="time" id="${day}_break_start" value="10:00">
                        <input type="time" id="${day}_break_end" value="10:20">
                    </div>
                </div>`;
            });
            
            plannerHTML += `<button onclick="saveWeeklyPlan()" class="btn btn-success save-btn">Save Weekly Plan</button>`;
            
            document.getElementById('weeklyPlanner').innerHTML = plannerHTML;
        }
        
        // SAVE FUNCTION
        function saveWeeklyPlan() {
            const weeklyPlan = {};
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            
            days.forEach(day => {
                weeklyPlan[day] = {};
                for (let period = 1; period <= 8; period++) {
                    weeklyPlan[day][`period${period}`] = {
                        subject: document.getElementById(`${day}_period${period}`).value,
                        startTime: document.getElementById(`${day}_period${period}_start`).value,
                        endTime: document.getElementById(`${day}_period${period}_end`).value
                    };
                }
                weeklyPlan[day].break = {
                    startTime: document.getElementById(`${day}_break_start`).value,
                    endTime: document.getElementById(`${day}_break_end`).value
                };
            });
            
            localStorage.setItem('yearlyPlan', JSON.stringify(weeklyPlan));
            alert('Weekly plan saved successfully!');
        }
    </script>
    
    <style>
        /* Frontend-Only Yearly Planner Styles */
        .planner-step {
            background: var(--light-gray);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .planner-step h2 {
            color: var(--sage-green);
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .grade-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .grade-btn {
            background: white;
            border: 3px solid var(--soft-blue);
            color: var(--soft-blue);
            padding: 1.5rem 2rem;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .grade-btn:hover {
            background: var(--soft-blue);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(108, 155, 209, 0.3);
        }
        
        /* Weekly Planner Styles */
        #weeklyPlanner {
            background: white;
        }
        
        #weeklyPlanner h2 {
            color: var(--sage-green);
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .day-column {
            background: var(--light-gray);
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem;
            display: inline-block;
            vertical-align: top;
            width: 280px;
        }
        
        .day-column h3 {
            color: var(--soft-blue);
            text-align: center;
            margin-bottom: 1rem;
            background: white;
            padding: 0.5rem;
            border-radius: 6px;
        }
        
        .period-row {
            background: white;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            border: 1px solid var(--border-gray);
        }
        
        .period-row label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .period-row select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .period-row input[type="time"] {
            width: 48%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .period-row input[type="time"]:first-of-type {
            margin-right: 4%;
        }
        
        .break-row {
            background: var(--peach);
            padding: 0.75rem;
            margin: 1rem 0;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
        }
        
        .break-row label {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .break-row input[type="time"] {
            width: 48%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .break-row input[type="time"]:first-of-type {
            margin-right: 4%;
        }
        
        .save-btn {
            display: block;
            margin: 2rem auto;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .day-column {
                width: 100%;
                margin: 1rem 0;
            }
            
            .grade-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .grade-btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
    
    <!-- Include existing CSS variables and common styles -->
        
        function autoFillSubjects() {
            if (confirm('Auto-fill subjects evenly across all periods?')) {
</body>
</html>
